è¦å®ç°é€šè¿‡å˜æ¢ä½¿å¾—å›¾åƒä¸­å››ä¸ªç‚¹ç»„æˆçš„å›¾å½¢å‚ç›´ï¼ˆå³æˆä¸ºçŸ©å½¢ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨OpenCVçš„é€è§†å˜æ¢ï¼ˆPerspective Transformationï¼‰ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†æ­¥éª¤å’Œä»£ç ç¤ºä¾‹ï¼š

### æ ¸å¿ƒæ€è·¯ï¼š
1. **æ’åºå››ä¸ªç‚¹**ï¼šå°†è¾“å…¥ç‚¹æŒ‰å›ºå®šé¡ºåºï¼ˆå·¦ä¸Šã€å³ä¸Šã€å³ä¸‹ã€å·¦ä¸‹ï¼‰æ’åºã€‚
2. **è®¡ç®—ç›®æ ‡çŸ©å½¢**ï¼šæ ¹æ®åŸå§‹ç‚¹é›†è®¡ç®—çŸ©å½¢çš„å®½åº¦å’Œé«˜åº¦ã€‚
3. **ç”Ÿæˆå˜æ¢çŸ©é˜µ**ï¼šä½¿ç”¨ `cv2.getPerspectiveTransform`ã€‚
4. **åº”ç”¨å˜æ¢**ï¼šä½¿ç”¨ `cv2.warpPerspective` è¿›è¡Œå›¾åƒå˜æ¢ã€‚

### ä»£ç å®ç°ï¼š
```python
import cv2
import numpy as np

def order_points(pts):
    """æŒ‰å›ºå®šé¡ºåºæ’åºå››ä¸ªç‚¹ï¼šå·¦ä¸Šã€å³ä¸Šã€å³ä¸‹ã€å·¦ä¸‹"""
    rect = np.zeros((4, 2), dtype="float32")
    s = pts.sum(axis=1)
    rect[0] = pts[np.argmin(s)]  # å·¦ä¸Šï¼šæ€»å’Œæœ€å°
    rect[2] = pts[np.argmax(s)]  # å³ä¸‹ï¼šæ€»å’Œæœ€å¤§
    
    diff = np.diff(pts, axis=1)
    rect[1] = pts[np.argmin(diff)]  # å³ä¸Šï¼šx-yæœ€å°
    rect[3] = pts[np.argmax(diff)]  # å·¦ä¸‹ï¼šx-yæœ€å¤§
    return rect

def transform_to_rectangle(image, pts):
    # å°†ç‚¹æ’åº
    rect = order_points(pts)
    (tl, tr, br, bl) = rect
    
    # è®¡ç®—æ–°çŸ©å½¢çš„æœ€å¤§å®½åº¦å’Œé«˜åº¦
    width_top = np.linalg.norm(tr - tl)
    width_bottom = np.linalg.norm(br - bl)
    max_width = max(int(width_top), int(width_bottom))
    
    height_left = np.linalg.norm(bl - tl)
    height_right = np.linalg.norm(br - tr)
    max_height = max(int(height_left), int(height_right))
    
    # å®šä¹‰ç›®æ ‡ç‚¹ï¼ˆç¡®ä¿é¡ºåºä¸rectä¸€è‡´ï¼‰
    dst = np.array([
        [0, 0],
        [max_width - 1, 0],
        [max_width - 1, max_height - 1],
        [0, max_height - 1]
    ], dtype="float32")
    
    # è®¡ç®—é€è§†å˜æ¢çŸ©é˜µå¹¶åº”ç”¨
    M = cv2.getPerspectiveTransform(rect, dst)
    warped = cv2.warpPerspective(image, M, (max_width, max_height))
    return warped

# ç¤ºä¾‹ä½¿ç”¨
if __name__ == "__main__":
    # è¯»å–å›¾åƒ
    image = cv2.imread("input.jpg")
    
    # å‡è®¾æœ‰å››ä¸ªç‚¹ï¼ˆæ ¼å¼ï¼š[[x1,y1], [x2,y2], [x3,y3], [x4,y4]]ï¼‰
    input_points = np.array([[50, 50], [200, 100], [220, 300], [30, 250]], dtype="float32")
    
    # æ‰§è¡Œå˜æ¢
    result = transform_to_rectangle(image, input_points)
    
    # ä¿å­˜ç»“æœ
    cv2.imwrite("output.jpg", result)
```

### å…³é”®è¯´æ˜ï¼š
1. **ç‚¹æ’åºå‡½æ•° (`order_points`)**ï¼š
   - é€šè¿‡åæ ‡å’Œï¼ˆ`x+y`ï¼‰ç¡®å®šå·¦ä¸Šï¼ˆæœ€å°ï¼‰å’Œå³ä¸‹ï¼ˆæœ€å¤§ï¼‰ã€‚
   - é€šè¿‡åæ ‡å·®ï¼ˆ`x-y`ï¼‰ç¡®å®šå³ä¸Šï¼ˆæœ€å°ï¼‰å’Œå·¦ä¸‹ï¼ˆæœ€å¤§ï¼‰ã€‚

2. **å°ºå¯¸è®¡ç®—**ï¼š
   - **å®½åº¦**ï¼šå–ä¸Šè¾¹ï¼ˆ`tr-tl`ï¼‰å’Œä¸‹è¾¹ï¼ˆ`br-bl`ï¼‰çš„æœ€å¤§é•¿åº¦ã€‚
   - **é«˜åº¦**ï¼šå–å·¦è¾¹ï¼ˆ`bl-tl`ï¼‰å’Œå³è¾¹ï¼ˆ`br-tr`ï¼‰çš„æœ€å¤§é•¿åº¦ã€‚

3. **ç›®æ ‡ç‚¹å®šä¹‰**ï¼š
   - æŒ‰ `(å·¦ä¸Š, å³ä¸Š, å³ä¸‹, å·¦ä¸‹)` é¡ºåºåˆ›å»ºç›®æ ‡çŸ©å½¢ã€‚

4. **å˜æ¢çŸ©é˜µ**ï¼š
   - `cv2.getPerspectiveTransform` æ ¹æ®æºç‚¹å’Œç›®æ ‡ç‚¹è®¡ç®—3x3å˜æ¢çŸ©é˜µã€‚
   - `cv2.warpPerspective` åº”ç”¨å˜æ¢å¹¶è¾“å‡ºçŸ«æ­£åçš„å›¾åƒã€‚

### æ•ˆæœï¼š
- è¾“å…¥ï¼šä»»æ„å››è¾¹å½¢ï¼ˆå¦‚å¹³è¡Œå››è¾¹å½¢ã€æ¢¯å½¢ï¼‰çš„å›¾åƒã€‚
- è¾“å‡ºï¼šçŸ«æ­£åçš„çŸ©å½¢å›¾åƒï¼Œå››è¾¹å‚ç›´ã€‚

### æ³¨æ„äº‹é¡¹ï¼š
- ç¡®ä¿è¾“å…¥ç‚¹æ˜¯ **é¡ºæ—¶é’ˆæˆ–é€†æ—¶é’ˆè¿ç»­** çš„å››è¾¹å½¢é¡¶ç‚¹ã€‚
- è‹¥ç‚¹é¡ºåºé”™è¯¯ï¼Œéœ€æ‰‹åŠ¨è°ƒæ•´æˆ–ä½¿ç”¨å‡¸åŒ…ï¼ˆ`cv2.convexHull`ï¼‰å¤„ç†ã€‚
- å˜æ¢åå›¾åƒå°ºå¯¸è‡ªåŠ¨é€‚é…çŸ©å½¢å®½é«˜ï¼Œè¾¹ç¼˜å¯èƒ½è¢«è£å‰ªã€‚

æ­¤æ–¹æ³•å¹¿æ³›ç”¨äºæ–‡æ¡£çŸ«æ­£ã€è½¦ç‰Œè¯†åˆ«ç­‰åœºæ™¯ï¼Œèƒ½æœ‰æ•ˆå°†ä»»æ„å››è¾¹å½¢æ˜ å°„ä¸ºçŸ©å½¢ã€‚

---

è¦å®ç° **é€è§†å˜æ¢ï¼ˆPerspective Transformationï¼‰** å¹¶ä¿ç•™å›¾åƒçš„å…¨éƒ¨åŒºåŸŸï¼ˆåŒ…æ‹¬å˜æ¢åå¯èƒ½è¶…å‡ºåŸå§‹è¾¹ç•Œçš„éƒ¨åˆ†ï¼‰ï¼Œä¸èƒ½ç›´æ¥ä½¿ç”¨ `cv2.warpAffine`ï¼ˆå®ƒä»…é€‚ç”¨äºä»¿å°„å˜æ¢ï¼Œå¦‚å¹³ç§»ã€æ—‹è½¬ã€ç¼©æ”¾ï¼Œä½†ä¸é€‚ç”¨äºé€è§†å˜æ¢ï¼‰ã€‚  

ä½†æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹æ³• **è®¡ç®—å˜æ¢åçš„å›¾åƒè¾¹ç•Œ**ï¼Œå¹¶è°ƒæ•´è¾“å‡ºå›¾åƒçš„å¤§å°ï¼Œç¡®ä¿æ‰€æœ‰å˜æ¢åçš„å†…å®¹éƒ½å¯è§ï¼š


### **æ–¹æ³•æ€è·¯**
1. **è®¡ç®—å˜æ¢åçš„å›¾åƒè¾¹ç•Œ**  
   - å°†åŸå§‹å›¾åƒçš„å››ä¸ªè§’ç‚¹ï¼ˆ`(0,0)`, `(w,0)`, `(w,h)`, `(0,h)`ï¼‰åº”ç”¨é€è§†å˜æ¢ `M`ï¼Œå¾—åˆ°å˜æ¢åçš„æ–°è¾¹ç•Œã€‚
   - è®¡ç®—è¿™äº›å˜æ¢åçš„ç‚¹çš„æœ€å°/æœ€å¤§åæ ‡ï¼Œä»¥ç¡®å®šè¾“å‡ºå›¾åƒçš„å¤§å°ã€‚

2. **è°ƒæ•´å˜æ¢çŸ©é˜µ `M`**  
   - å¦‚æœå˜æ¢åçš„åæ ‡æœ‰è´Ÿå€¼ï¼Œæˆ‘ä»¬éœ€è¦å¹³ç§»æ•´ä¸ªå›¾åƒï¼Œä½¿æ‰€æœ‰ç‚¹éƒ½åœ¨æ­£åæ ‡èŒƒå›´å†…ã€‚
   - ä¿®æ”¹ `M` ä»¥åŒ…å«å¹³ç§»åç§»é‡ã€‚

3. **ä½¿ç”¨ `cv2.warpPerspective` è¿›è¡Œå˜æ¢**  
   - è®¾ç½®è¾“å‡ºå›¾åƒçš„å¤§å°è¶³å¤Ÿå¤§ï¼Œä»¥å®¹çº³å˜æ¢åçš„æ‰€æœ‰å†…å®¹ã€‚

---

### **ä»£ç å®ç°**
```python
import cv2
import numpy as np

def order_points(pts):
    """æŒ‰å›ºå®šé¡ºåºæ’åºå››ä¸ªç‚¹ï¼šå·¦ä¸Šã€å³ä¸Šã€å³ä¸‹ã€å·¦ä¸‹"""
    rect = np.zeros((4, 2), dtype="float32")
    s = pts.sum(axis=1)
    rect[0] = pts[np.argmin(s)]  # å·¦ä¸Šï¼šæ€»å’Œæœ€å°
    rect[2] = pts[np.argmax(s)]  # å³ä¸‹ï¼šæ€»å’Œæœ€å¤§
    
    diff = np.diff(pts, axis=1)
    rect[1] = pts[np.argmin(diff)]  # å³ä¸Šï¼šx-yæœ€å°
    rect[3] = pts[np.argmax(diff)]  # å·¦ä¸‹ï¼šx-yæœ€å¤§
    return rect

def transform_perspective_full(image, pts):
    """é€è§†å˜æ¢ï¼Œå¹¶ä¿ç•™æ‰€æœ‰åŒºåŸŸï¼ˆåŒ…æ‹¬è¶…å‡ºåŸå§‹å›¾åƒçš„éƒ¨åˆ†ï¼‰"""
    # 1. æ’åºè¾“å…¥ç‚¹ï¼ˆå·¦ä¸Šã€å³ä¸Šã€å³ä¸‹ã€å·¦ä¸‹ï¼‰
    rect = order_points(pts)
    (tl, tr, br, bl) = rect
    
    # 2. è®¡ç®—ç›®æ ‡çŸ©å½¢çš„å®½åº¦å’Œé«˜åº¦
    width_top = np.linalg.norm(tr - tl)
    width_bottom = np.linalg.norm(br - bl)
    max_width = max(int(width_top), int(width_bottom))
    
    height_left = np.linalg.norm(bl - tl)
    height_right = np.linalg.norm(br - tr)
    max_height = max(int(height_left), int(height_right))
    
    # 3. å®šä¹‰ç›®æ ‡ç‚¹ï¼ˆç¡®ä¿é¡ºåºä¸ rect ä¸€è‡´ï¼‰
    dst = np.array([
        [0, 0],
        [max_width - 1, 0],
        [max_width - 1, max_height - 1],
        [0, max_height - 1]
    ], dtype="float32")
    
    # 4. è®¡ç®—é€è§†å˜æ¢çŸ©é˜µ
    M = cv2.getPerspectiveTransform(rect, dst)
    
    # 5. è®¡ç®—åŸå§‹å›¾åƒçš„å››ä¸ªè§’ç‚¹å˜æ¢åçš„ä½ç½®
    h, w = image.shape[:2]
    original_corners = np.array([
        [0, 0],
        [w, 0],
        [w, h],
        [0, h]
    ], dtype="float32").reshape(-1, 1, 2)
    
    # 6. è®¡ç®—å˜æ¢åçš„è§’ç‚¹
    transformed_corners = cv2.perspectiveTransform(original_corners, M)
    
    # 7. è®¡ç®—å˜æ¢åå›¾åƒçš„æ–°è¾¹ç•Œï¼ˆå¯èƒ½åŒ…å«è´Ÿåæ ‡ï¼‰
    x_min = int(np.floor(transformed_corners[:, 0, 0].min()))
    x_max = int(np.ceil(transformed_corners[:, 0, 0].max()))
    y_min = int(np.floor(transformed_corners[:, 0, 1].min()))
    y_max = int(np.ceil(transformed_corners[:, 0, 1].max()))
    
    # 8. è°ƒæ•´å˜æ¢çŸ©é˜µï¼Œä½¿æ‰€æœ‰åæ ‡ä¸ºæ­£ï¼ˆé¿å…è£å‰ªï¼‰
    # å¹³ç§»å˜æ¢åçš„å›¾åƒï¼Œä½¿æœ€å°åæ ‡ä¸º (0, 0)
    translation_x = -x_min if x_min < 0 else 0
    translation_y = -y_min if y_min < 0 else 0
    
    # æ›´æ–° M ä»¥åŒ…å«å¹³ç§»
    M[0, 2] += translation_x
    M[1, 2] += translation_y
    
    # 9. è®¡ç®—æ–°çš„è¾“å‡ºå›¾åƒå°ºå¯¸
    new_width = x_max - x_min
    new_height = y_max - y_min
    
    # 10. æ‰§è¡Œé€è§†å˜æ¢ï¼ˆä¿ç•™æ‰€æœ‰åŒºåŸŸï¼‰
    warped = cv2.warpPerspective(
        image, M, 
        (new_width, new_height),
        flags=cv2.INTER_LINEAR,
        borderMode=cv2.BORDER_CONSTANT,
        borderValue=(0, 0, 0)  # å¡«å……é»‘è‰²ï¼ˆå¯é€‰ï¼‰
    )
    
    return warped

# ç¤ºä¾‹ä½¿ç”¨
if __name__ == "__main__":
    image = cv2.imread("input.jpg")
    input_points = np.array([[50, 50], [200, 100], [220, 300], [30, 250]], dtype="float32")
    
    # æ‰§è¡Œå˜æ¢ï¼ˆä¿ç•™æ‰€æœ‰åŒºåŸŸï¼‰
    result = transform_perspective_full(image, input_points)
    
    cv2.imwrite("output_full.jpg", result)
```

---

### **å…³é”®è¯´æ˜**
1. **`cv2.perspectiveTransform`**  
   - ç”¨äºè®¡ç®—åŸå§‹å›¾åƒå››ä¸ªè§’ç‚¹å˜æ¢åçš„ä½ç½®ï¼Œä»¥ç¡®å®šè¾“å‡ºå›¾åƒçš„å¤§å°ã€‚

2. **è°ƒæ•´ `M` ä»¥åŒ…å«å¹³ç§»**  
   - å¦‚æœå˜æ¢åçš„åæ ‡æœ‰è´Ÿå€¼ï¼ˆå¦‚ `x_min < 0`ï¼‰ï¼Œæˆ‘ä»¬ä¿®æ”¹ `M[0, 2]` å’Œ `M[1, 2]`ï¼ˆå¹³ç§»åˆ†é‡ï¼‰ï¼Œä½¿æ‰€æœ‰åæ ‡å˜ä¸ºæ­£ã€‚

3. **è¾“å‡ºå›¾åƒå°ºå¯¸**  
   - æœ€ç»ˆå°ºå¯¸ `(new_width, new_height)` ç¡®ä¿æ‰€æœ‰å˜æ¢åçš„å†…å®¹éƒ½å¯è§ã€‚

4. **`cv2.warpPerspective` å‚æ•°**  
   - `borderMode=cv2.BORDER_CONSTANT`ï¼šå¡«å……é»‘è‰²ï¼ˆå¯é€‰å…¶ä»–é¢œè‰²ï¼‰ã€‚
   - `flags=cv2.INTER_LINEAR`ï¼šæ’å€¼æ–¹å¼ï¼ˆå¯é€‰ `INTER_CUBIC` æˆ– `INTER_NEAREST`ï¼‰ã€‚

---

### **æ•ˆæœ**
- **è¾“å…¥**ï¼šä»»æ„å››è¾¹å½¢ï¼ˆå¦‚å€¾æ–œçš„çŸ©å½¢ï¼‰ã€‚
- **è¾“å‡º**ï¼šçŸ«æ­£åçš„çŸ©å½¢ï¼Œä¸”æ‰€æœ‰åŸå§‹å›¾åƒå†…å®¹å¯è§ï¼ˆæ— è£å‰ªï¼‰ã€‚

---

### **æ³¨æ„äº‹é¡¹**
- **`cv2.warpAffine` ä¸é€‚ç”¨**ï¼šä»¿å°„å˜æ¢ï¼ˆ`warpAffine`ï¼‰æ— æ³•å¤„ç†é€è§†å˜æ¢ï¼Œå¿…é¡»ä½¿ç”¨ `warpPerspective`ã€‚
- **æ€§èƒ½ä¼˜åŒ–**ï¼šå¦‚æœå›¾åƒå¾ˆå¤§ï¼Œè®¡ç®—å˜æ¢åçš„è¾¹ç•Œå¯èƒ½ä¼šç¨æ…¢ï¼Œä½†é€šå¸¸å½±å“ä¸å¤§ã€‚

è¿™æ ·å¤„ç†åï¼ŒçŸ«æ­£åçš„å›¾åƒå°†åŒ…å«æ‰€æœ‰åŸå§‹å†…å®¹ï¼Œè€Œä¸ä»…ä»…æ˜¯çŸ©å½¢åŒºåŸŸï¼ ğŸš€

---
å¦‚æœä½ å¸Œæœ›åœ¨åº”ç”¨é€è§†å˜æ¢åï¼Œ**ä¿æŒå›¾åƒçš„åŸå§‹å°ºå¯¸**ï¼ˆå³è¾“å‡ºå›¾åƒå¤§å°ä¸è¾“å…¥ç›¸åŒï¼‰ï¼ŒåŒæ—¶ç¡®ä¿å˜æ¢åçš„å†…å®¹ä¸è¢«è£å‰ªï¼Œå¯ä»¥æŒ‰ä»¥ä¸‹æ–¹å¼è°ƒæ•´ï¼š


### **æ–¹æ³•æ€è·¯**
1. **è®¡ç®—å˜æ¢åçš„å›¾åƒè¾¹ç•Œ**  
   - å°†åŸå§‹å›¾åƒçš„å››ä¸ªè§’ç‚¹ `(0,0)`, `(w,0)`, `(w,h)`, `(0,h)` åº”ç”¨é€è§†å˜æ¢ `M`ï¼Œå¾—åˆ°å˜æ¢åçš„æ–°è¾¹ç•Œã€‚
   - è®¡ç®—è¿™äº›å˜æ¢åçš„ç‚¹çš„æœ€å°/æœ€å¤§åæ ‡ï¼Œç¡®å®šæ˜¯å¦éœ€è¦ç¼©æ”¾æˆ–å¹³ç§»ã€‚

2. **è°ƒæ•´å˜æ¢çŸ©é˜µ `M`**  
   - å¦‚æœå˜æ¢åçš„å†…å®¹è¶…å‡ºåŸå§‹å›¾åƒå°ºå¯¸ï¼Œå¯ä»¥ï¼š
     - **ç¼©æ”¾**ï¼šè°ƒæ•´ `M` ä½¿å˜æ¢åçš„å†…å®¹é€‚åº”åŸå§‹å°ºå¯¸ã€‚
     - **å¹³ç§»**ï¼šç§»åŠ¨å˜æ¢åçš„å†…å®¹åˆ°å›¾åƒä¸­å¿ƒã€‚

3. **ä½¿ç”¨ `cv2.warpPerspective` å¹¶æŒ‡å®š `dsize=(åŸå§‹å®½åº¦, åŸå§‹é«˜åº¦)`**  
   - ç›´æ¥å¼ºåˆ¶è¾“å‡ºå›¾åƒä¸è¾“å…¥åŒå°ºå¯¸ï¼Œä½†å¯èƒ½éƒ¨åˆ†å†…å®¹è¢«è£å‰ªï¼ˆéœ€æƒè¡¡ï¼‰ã€‚

---

### **ä»£ç å®ç°**
```python
import cv2
import numpy as np

def order_points(pts):
    """æŒ‰å›ºå®šé¡ºåºæ’åºå››ä¸ªç‚¹ï¼šå·¦ä¸Šã€å³ä¸Šã€å³ä¸‹ã€å·¦ä¸‹"""
    rect = np.zeros((4, 2), dtype="float32")
    s = pts.sum(axis=1)
    rect[0] = pts[np.argmin(s)]  # å·¦ä¸Šï¼šæ€»å’Œæœ€å°
    rect[2] = pts[np.argmax(s)]  # å³ä¸‹ï¼šæ€»å’Œæœ€å¤§
    
    diff = np.diff(pts, axis=1)
    rect[1] = pts[np.argmin(diff)]  # å³ä¸Šï¼šx-yæœ€å°
    rect[3] = pts[np.argmax(diff)]  # å·¦ä¸‹ï¼šx-yæœ€å¤§
    return rect

def transform_perspective_keep_size(image, pts):
    """é€è§†å˜æ¢å¹¶ä¿æŒåŸå§‹å›¾åƒå°ºå¯¸"""
    h, w = image.shape[:2]
    rect = order_points(pts)
    (tl, tr, br, bl) = rect
    
    # è®¡ç®—ç›®æ ‡çŸ©å½¢çš„å®½åº¦å’Œé«˜åº¦ï¼ˆä¿æŒåŸå§‹æ¯”ä¾‹ï¼‰
    width_top = np.linalg.norm(tr - tl)
    width_bottom = np.linalg.norm(br - bl)
    max_width = max(int(width_top), int(width_bottom))
    
    height_left = np.linalg.norm(bl - tl)
    height_right = np.linalg.norm(br - tr)
    max_height = max(int(height_left), int(height_right))
    
    # å®šä¹‰ç›®æ ‡ç‚¹ï¼ˆç¼©æ”¾åˆ°åŸå§‹å›¾åƒå°ºå¯¸çš„æ¯”ä¾‹ï¼‰
    scale_x = w / max_width
    scale_y = h / max_height
    scale = min(scale_x, scale_y)  # é€‰æ‹©è¾ƒå°çš„ç¼©æ”¾æ¯”ä¾‹ä»¥ä¿æŒå†…å®¹å®Œæ•´
    
    dst = np.array([
        [0, 0],
        [max_width - 1, 0],
        [max_width - 1, max_height - 1],
        [0, max_height - 1]
    ], dtype="float32") * scale  # ç¼©æ”¾ç›®æ ‡ç‚¹
    
    # å¹³ç§»ç›®æ ‡ç‚¹åˆ°å›¾åƒä¸­å¿ƒ
    dst[:, 0] += (w - dst[:, 0].max()) / 2
    dst[:, 1] += (h - dst[:, 1].max()) / 2
    
    # è®¡ç®—é€è§†å˜æ¢çŸ©é˜µ
    M = cv2.getPerspectiveTransform(rect, dst)
    
    # åº”ç”¨å˜æ¢ï¼ˆè¾“å‡ºå°ºå¯¸ä¸è¾“å…¥ç›¸åŒï¼‰
    warped = cv2.warpPerspective(
        image, M, (w, h),
        flags=cv2.INTER_LINEAR,
        borderMode=cv2.BORDER_CONSTANT,
        borderValue=(0, 0, 0)  # å¡«å……é»‘è‰²
    )
    return warped

# ç¤ºä¾‹ä½¿ç”¨
if __name__ == "__main__":
    image = cv2.imread("input.jpg")
    input_points = np.array([[50, 50], [200, 100], [220, 300], [30, 250]], dtype="float32")
    
    # æ‰§è¡Œå˜æ¢ï¼ˆä¿æŒåŸå§‹å°ºå¯¸ï¼‰
    result = transform_perspective_keep_size(image, input_points)
    
    cv2.imwrite("output_keep_size.jpg", result)
```

---

### **å…³é”®è¯´æ˜**
1. **ç›®æ ‡ç‚¹ç¼©æ”¾ (`scale`)**  
   - æ ¹æ®åŸå§‹å›¾åƒå°ºå¯¸ (`w, h`) å’Œå˜æ¢åçš„çŸ©å½¢å°ºå¯¸ (`max_width, max_height`) è®¡ç®—ç¼©æ”¾æ¯”ä¾‹ã€‚
   - é€‰æ‹©è¾ƒå°çš„æ¯”ä¾‹ (`min(scale_x, scale_y)`) ç¡®ä¿å†…å®¹å®Œæ•´ã€‚

2. **å¹³ç§»ç›®æ ‡ç‚¹åˆ°ä¸­å¿ƒ**  
   - è°ƒæ•´ `dst` çš„åæ ‡ï¼Œä½¿å˜æ¢åçš„å†…å®¹ä½äºå›¾åƒä¸­å¿ƒã€‚

3. **è¾“å‡ºå°ºå¯¸å¼ºåˆ¶åŒ¹é…è¾“å…¥**  
   - `cv2.warpPerspective` çš„ `dsize=(w, h)` ç¡®ä¿è¾“å‡ºä¸è¾“å…¥åŒå°ºå¯¸ã€‚

4. **å¡«å……å¤„ç† (`borderMode`)**  
   - è¶…å‡ºåŸå§‹å›¾åƒçš„éƒ¨åˆ†å¡«å……é»‘è‰²ï¼ˆå¯é€šè¿‡ `borderValue` ä¿®æ”¹ï¼‰ã€‚

---

### **æ•ˆæœ**
- **è¾“å…¥**ï¼šä»»æ„å››è¾¹å½¢ï¼ˆå¦‚å€¾æ–œçš„çŸ©å½¢ï¼‰ã€‚
- **è¾“å‡º**ï¼šçŸ«æ­£åçš„çŸ©å½¢ï¼Œå°ºå¯¸ä¸è¾“å…¥ç›¸åŒï¼Œå†…å®¹å±…ä¸­æ˜¾ç¤ºï¼Œè¾¹ç¼˜å¡«å……é»‘è‰²ã€‚

---

### **æ³¨æ„äº‹é¡¹**
- **å†…å®¹å®Œæ•´æ€§**ï¼šå¦‚æœå˜æ¢åçš„å†…å®¹è¿œå¤§äºåŸå§‹å°ºå¯¸ï¼Œç¼©æ”¾å¯èƒ½å¯¼è‡´å†…å®¹è¿‡å°ã€‚
- **ä¼˜åŒ–é€‰æ‹©**ï¼šè‹¥éœ€ä¿ç•™æ›´å¤šç»†èŠ‚ï¼Œå¯æ”¾å¼ƒå›ºå®šå°ºå¯¸ï¼Œæ”¹ç”¨åŠ¨æ€å°ºå¯¸ï¼ˆå‚è€ƒå‰æ–‡æ–¹æ³•ï¼‰ã€‚

è¿™æ ·å³å¯åœ¨ä¿æŒåŸå§‹å°ºå¯¸çš„åŒæ—¶å®Œæˆé€è§†çŸ«æ­£ï¼ ğŸ¯